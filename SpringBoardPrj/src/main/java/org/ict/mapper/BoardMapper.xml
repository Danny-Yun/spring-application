<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 위의 스키마 작성 후, 어떤 인터페이스의 메서드를 쿼리문과 연결해줄지 아래와 같이 
	인터페이스 파일부터 mapper태그로 연결한다.  -->
<mapper namespace="org.ict.mapper.BoardMapper">
	
	<!-- 위의 BoardMapper 인터페이스의 getList메서드를 호출시 실제로 실행할
		쿼리문을 아래와 같이 연결해준다. mybatis는 단일자료와 리스트자료를 
		구분하지 않기 때문에 resultType에는 List<> 자료형도 아래와 같이 단일 
		VO만 적여주면 된다. -->
	<select id="getList" resultType="org.ict.domain.BoardVO">
		<!-- <이나 >과 같이 태그로 오인될 수 있는 문자를 포함하는 쿼리문은
			그냥 작성하지 않고, CDATA를 이용하면 된다. 아래와 같이 
			<![CDATA[ 실행문 ]]>과 같이 실행문을 CDATA내부에 작성하면 
			내부의 부등호는 전부 문자로 간주된다. -->
			<!--  쿼리문에서 like절을 사용하는 경우 #{변수명} 대신 
			'%'||#{변수명}||'%'을 사용해야 한다. (oracle)
			CONCAT('%',#{변수명},'%') (mysql) -->
		<![CDATA[
			SELECT * FROM board_tbl WHERE b_title LIKE '%'||#{keyword}||'%' 
			ORDER BY b_no DESC
		]]>
	</select>
	
	<!-- 현재 insert는 BoardVO를 파라미터로 받고 있기 때문에 
		VO 내부 변수를 #{변수명} 으로 쿼리문에 전달할 수 있다. -->
	<insert id="insert">
		INSERT INTO board_tbl (b_no, b_title, b_content, b_writer) 
			VALUES (board_num.nextval, #{b_title}, #{b_content}, #{b_writer})
	</insert>
	
	<!-- 위의 insert 메서드는 쿼리문을 한 번만 실행해도 데이터가 입력되지만 b_no에 들어갈 값을 
		미리 확인할 수 없다. b_no에 들어갈 값을 확인할 수 있도록 insert실행 이전에 b_no값을
		외부에서 조회할 수 있도록 변수화시키는 작업이 필요하다. 이 작업을 실행할 때 사용하는 태그가
		바로 selectkey 태그이다. -->
	<insert id="insertSelectKey">
		<!-- 실행 이전에 b_no값을 먼저 조회해서 b_no변수명으로 저장
			keyProperty에 변수명을, order에 BEFORE를 넣어서 
			insert쿼리문 실행 이전에 조회한 b_no값을 b_no라는 명칭에 저장 -->
		<selectKey keyProperty="b_no" order="BEFORE" resultType="long">
			SELECT board_num.nextval FROM dual
		</selectKey> 
		
		INSERT INTO board_tbl (b_no, b_title, b_content, b_writer) 
			VALUES (#{b_no}, #{b_title}, #{b_content}, #{b_writer})
	</insert>
	
	<select id="select" resultType="org.ict.domain.BoardVO">
		SELECT * FROM board_tbl WHERE b_no=#{b_no}
	</select>
	
	<delete id="delete">
		DELETE FROM board_tbl WHERE b_no=#{b_no}
	</delete>
	
	<update id="update">
		UPDATE board_tbl 
			SET 
		b_title=#{b_title}, b_content=#{b_content}, b_updatedate=SYSDATE
			WHERE 
		b_no=#{b_no}
	</update>
	
	<select id="getListPaging" resultType="org.ict.domain.BoardVO">
		<![CDATA[
			SELECT * FROM
				(SELECT /*+ INDEX_DESC(board_tbl pk_board) */
				 rownum rn, board_tbl.* FROM board_tbl WHERE rownum <= #{pageNum} * #{amount})
			WHERE rn > (#{pageNum} - 1) * #{amount}
		]]>
	</select>
	
	<select id="getBoardTotal" resultType="int">
		SELECT COUNT(*) FROM board_tbl
	</select>
	
</mapper>